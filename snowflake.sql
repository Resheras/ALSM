CREATE OR REPLACE SEQUENCE seq_01 START = 1 INCREMENT = 1;

CREATE OR REPLACE TABLE X_AUG (
ROW_ID NUMBER DEFAULT seq_01.NEXTVAL,
min_val number(38,5),
max_val number(38,5),
diff_val number(38,5),
len_val number(38,5),
mean_val number(38,5),
med_val number(38,5),
std_val number(38,5),
var_val number(38,5),
bpm number(38,5),
ibi number(38,5),
sdnn number(38,5),
sdsd number(38,5),
rmssd number(38,5),
pnn20 number(38,5),
pnn50 number(38,5),
hr_mad number(38,5),
sd1 number(38,5),
sd2 number(38,5),
s number(38,5),
sd1sd2 number(38,5),
breathingrate number(38,5),
vlf number(38,5),
lf number(38,5),
hf number(38,5),
lfhf number(38,5),
p_total number(38,5),
vlf_perc number(38,5),
lf_perc number(38,5),
hf_perc number(38,5),
lf_nu number(38,5),
hf_nu number(38,5),
is_noisy number(38,5),
autocorr_norm_peak_count number(38,5),
autocorr_max_peak_height number(38,5),
bpm_variability number(38,5),
dominant_freq_hz number(38,5),
heart_rate_bpm number(38,5),
pred number(38,0)
);


copy into X_AUG(
min_val,
max_val,
diff_val,
len_val,
mean_val,
med_val,
std_val,
var_val,
bpm,
ibi,
sdnn,
sdsd,
rmssd,
pnn20,
pnn50,
hr_mad,
sd1,
sd2,
s,
sd1sd2,
breathingrate,
vlf,
lf,
hf,
lfhf,
p_total,
vlf_perc,
lf_perc,
hf_perc,
lf_nu,
hf_nu,
is_noisy,
autocorr_norm_peak_count,
autocorr_max_peak_height,
bpm_variability,
dominant_freq_hz,
heart_rate_bpm,
pred
)
from 
(select 
$1,
$2,
$3,
$4,
$5,
$6,
$7,
$8,
$9,
$10,
$11,
$12,
$13,
$14,
$15,
$16,
$17,
$18,
$19,
$20,
$21,
$22,
$23,
$24,
$25,
$26,
$27,
$28,
$29,
$30,
$31,
$32,
$33,
$34,
$35,
$36,
$37,
$38
from @DATA/X_train_augmented2.csv);

copy into X_TEST(
min_val,
max_val,
diff_val,
len_val,
mean_val,
med_val,
std_val,
var_val,
bpm,
ibi,
sdnn,
sdsd,
rmssd,
pnn20,
pnn50,
hr_mad,
sd1,
sd2,
s,
sd1sd2,
breathingrate,
vlf,
lf,
hf,
lfhf,
p_total,
vlf_perc,
lf_perc,
hf_perc,
lf_nu,
hf_nu,
is_noisy,
autocorr_norm_peak_count,
autocorr_max_peak_height,
bpm_variability,
dominant_freq_hz,
heart_rate_bpm
)
from 
(select 
$1,
$2,
$3,
$4,
$5,
$6,
$7,
$8,
$9,
$10,
$11,
$12,
$13,
$14,
$15,
$16,
$17,
$18,
$19,
$20,
$21,
$22,
$23,
$24,
$25,
$26,
$27,
$28,
$29,
$30,
$31,
$32,
$33,
$34,
$35,
$36,
$37
from @DATA/X_t1.csv);

select * from X_AUG;

CREATE OR REPLACE TABLE DATA_TRAINING_AUG AS
SELECT * FROM AMLS.TASK.X_AUG SAMPLE (80);


CREATE OR REPLACE TABLE DATA_TEST AS
SELECT 
*
FROM AMLS.TASK.X_AUG
WHERE ROW_ID NOT IN ( SELECT ROW_ID FROM DATA_TRAINING_AUG
);

CREATE OR REPLACE VIEW binary_classification_view_aug AS
SELECT 
min_val,
max_val,
diff_val,
len_val,
mean_val,
med_val,
std_val,
var_val,
bpm,
ibi,
sdnn,
sdsd,
rmssd,
pnn20,
pnn50,
hr_mad,
sd1,
sd2,
s,
sd1sd2,
breathingrate,
vlf,
lf,
hf,
lfhf,
p_total,
vlf_perc,
lf_perc,
hf_perc,
lf_nu,
hf_nu,
is_noisy,
autocorr_norm_peak_count,
autocorr_max_peak_height,
bpm_variability,
dominant_freq_hz,
heart_rate_bpm,
pred
FROM DATA_TRAINING_AUG;

CREATE OR REPLACE SNOWFLAKE.ML.CLASSIFICATION model_pred(
    INPUT_DATA => SYSTEM$REFERENCE('view', 'binary_classification_view_aug'),
    TARGET_COLNAME => 'pred'
);

CREATE OR REPLACE TABLE PREDICTION_RESULTS_aug as
SELECT 
min_val,
max_val,
diff_val,
len_val,
mean_val,
med_val,
std_val,
var_val,
bpm,
ibi,
sdnn,
sdsd,
rmssd,
pnn20,
pnn50,
hr_mad,
sd1,
sd2,
s,
sd1sd2,
breathingrate,
vlf,
lf,
hf,
lfhf,
p_total,
vlf_perc,
lf_perc,
hf_perc,
lf_nu,
hf_nu,
is_noisy,
autocorr_norm_peak_count,
autocorr_max_peak_height,
bpm_variability,
dominant_freq_hz,
heart_rate_bpm,
pred,
model_pred!PREDICT(INPUT_DATA => {*})
    AS predictions FROM DATA_TEST;


CALL model_pred!SHOW_GLOBAL_EVALUATION_METRICS();
CALL model_pred!SHOW_EVALUATION_METRICS();
CALL model_pred!SHOW_THRESHOLD_METRICS();
CALL model_pred!SHOW_CONFUSION_MATRIX();
CALL model_pred!SHOW_FEATURE_IMPORTANCE();


select * from PREDICTION_RESULTS_aug;

CREATE OR REPLACE TABLE PREDICTION_RESULTS_final as
SELECT 
row_id,
min_val,
max_val,
diff_val,
len_val,
mean_val,
med_val,
std_val,
var_val,
bpm,
ibi,
sdnn,
sdsd,
rmssd,
pnn20,
pnn50,
hr_mad,
sd1,
sd2,
s,
sd1sd2,
breathingrate,
vlf,
lf,
hf,
lfhf,
p_total,
vlf_perc,
lf_perc,
hf_perc,
lf_nu,
hf_nu,
is_noisy,
autocorr_norm_peak_count,
autocorr_max_peak_height,
bpm_variability,
dominant_freq_hz,
heart_rate_bpm,
model_pred!PREDICT(INPUT_DATA => {*})
    AS predictions FROM X_TEST;


select row_id, to_number(predictions:class) from PREDICTION_RESULTS_final order by 1;  

select * FROM X_TEST;